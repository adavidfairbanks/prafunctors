\documentclass{amsart}
\input{decls}
\title{Polynomial comonoids and bicomodules}
\begin{document}
\maketitle

\iffalse
  A \emph{polynomial}\footnote{The name refers to a correspondence
    between families of sets and sums of powers, illustrated by the
    example
    ${2y^4 + y^2 + y \leftrightarrow
      \{\{\ast,\ast,\ast,\ast\},\{\ast,\ast,\ast,\ast\},\{\ast,\ast\},
      \{\ast\}\}}$.} is an indexed family of sets.

  The indexes of sets are called \emph{positions}, and the members of
  indexed sets are called \emph{directions}.

  We will visualize a polynomial as a collection of corollas.

  % figure

  A corolla is a node with arrows pointing out from it; this denotes a
  position and the directions from it.
\fi

Recall the \emph{substitution product} of polynomials $P$ and $Q$, denoted
$P \sub Q$.

\iffalse
  From polynomials $P$ and $Q$, we can form a new polynomial
  of all the possible two-story trees built by stacking $Q$
  corollas atop a $P$ corolla. This is called the \emph{substitution
    product}, denoted $P \sub Q$.
\fi

\begin{itemize}
\item A position $a$ in $P \sub Q$ consists of a position $a_\base$ in
  $P$ and positions $a_f$ in $Q$ for each direction $f$ from
  $a_\base$.
\item A direction from position $a$ in $P \sub Q$ consists of a
  direction $f$ from $a_\base$ and a direction $g$ from $a_f$.
\end{itemize}
\vspace{.5em}
\begin{center}
  \input{fig/sub1.tikz}
  \qquad
  {\Large$=$}
  \quad
  \input{fig/sub2.tikz}
\end{center}
\vspace{1em}

We denote such a direction from such a position in a substitution
product by $f \subd g$.\footnote{Be aware there may be other
  directions named $f \subd g$ from other positions in
  $P \sub Q$.} Accordingly, $\idsubd$ will denote the unique direction
from the unique position in the unit for substitution $\idsub$
(a.k.a. the polynomial $y$).\iffalse\footnote{Given directions $f$,
    $g$, and $h$ respectively belonging to polynomials $P$, $Q$, and
    $R$, directions of the form $(f \subd g)\subd h$ belonging to
    $(P \sub Q) \sub R$ and directions of the form
    $f \subd (g \subd h)$ belonging to $P \sub (Q \sub R)$ are
    identified under the relevant monoidal coherence
    isomorphism. Hence brackets can be omitted.

  Similarly, for any direction $f$ belonging to a polynomial $P$, we
  have that $\idsubd \subd f$ and $f \subd \idsubd$ (respectively
  belonging to $\idsub \sub P$ and $P \sub \idsub$) are both
  canonically identified with $f$.}\fi

\iffalse
  Suppose we have polynomials $P$ and $Q$ and the following
  structure relating them.
  \begin{itemize}
  \item A function $\posmap{\alpha}$ from the positions of $P$ to the
    positions of $Q$.
  \item For each position $a$ in $P$, a function $\dirmap{\alpha}{a}$ from the
    directions of $\alpha(a)$ back to the directions of $a$.
  \end{itemize}
  This is called a \emph{transformation} from $P$ to $Q$ (written
  $\alpha: P \to Q$).

  We think of this as a way of replacing each corolla from $P$ with a
  a corolla from $Q$.

  % diagram

  The \emph{composite} of transformations $\alpha : P \to Q$ and
  $\beta : Q \to R$, denoted $\alpha \fatsemi \beta : P \to R$,
  is defined by
  \[
    \posmapof{(\alpha \fatsemi \beta)}{a} = \posmapof{\beta}{\posmapof{\alpha}{a}}
    \quad \text{ and } \quad
    \dirmapof{(\alpha \fatsemi \beta)}{a}{f} =
    \dirmapof{\alpha}{a}{\dirmapof{\beta}{\posmapof{\alpha}{a}}{f}},
  \] i.e., we do the corolla replacements in order.

  % diagram

  This definition of transformation plays well with the substitution
  product.

  % definition of parallel composition of transformations
\fi

Note the following identity for transformations $\alpha$ and $\beta$
between polynomials.
\[\dirmapof{(\alpha \sub \beta)}{a}{f \subd g} = \underbrace{\dirmapof{\alpha}{(a_\base)}{f}}_{\backref}
  \subd \dirmapof{\beta}{(a_{\backref})}{g}.\] Or in brief, ``we have
$\anydirmapof{(\alpha \sub \beta)}{f \subd g} = \anydirmapof{\alpha}{f}
\subd\anydirmapof{\beta}{g}$ whenever this makes sense.''\iffalse\footnote{Meaning,
  ${\dirmapof{(\alpha \sub \beta)}{a}{f \subd g}}$ is defined $\iff$
  there are $u$ and $v$ such that
  ${\dirmapof{\alpha}{u}{f} \subd \dirmapof{\beta}{v}{g}}$ actually
  describes a direction from $a$; in this case, the former and latter
  are equal.
  
  (We are assuming the analogue of this property holds for $\alpha$
  and $\beta$ themselves: if any $\dirmapof{\alpha}{u}{f}$ has the same
  name as a direction from $a$, then $\dirmapof{\alpha}{a}{f}$ is
  defined with that value --- and likewise for $\beta$. This is
  trivially so if across the domains of $\alpha$ and $\beta$ we use
  different names for different directions.)
}\fi

\iffalse
  The directions from $a$ are of the form $f' \subd g'$,
  where $f'$ is a direction from $a_\base$ and $g'$ is a direction
  from $a_{f'}$. Hence if the expression
  $\dirmapof{\alpha}{x}{f} \subd dirmapof{\beta}{y}{g}$ is to describe a
  direction from $a$, then $x$ should be $a_\base$, and $y$ should
  be $a_{f'}$.
\fi

\iffalse Given a transformation $\alpha$, the map $\posmap{\alpha}$ is
  implicitly determined by the domains of the $\anydirmap{\alpha}$
  maps. Moreover, a position in a substitution product is determined
  by the set of names of directions from it (assuming the positions in
  the factor polynomials have this property too --- which is not true
  for polynomials featuring multiple constants), even though distinct
  positions may share certain direction names.

  Hence an equation between horizontal ($\sub$) composites of transformations
  amounts to firstly an identification between domains of the composite
  $\sharp$ maps and secondly their agreement in mapping.

  (We can more generally think of any equality between transformations in
  terms of identification of $\sharp$ maps' domains and their
  agreement in mapping. But this is only interesting when we
  have some reason to think of distinct $\sharp$ domains as sharing
  certain direction names.)

  We can translate arbitrary equalities built from $\sub$
  into equalities built from $\subd$, e.g.
  \[\gamma \fatsemi (\alpha \sub \beta) = \delta \sub \varepsilon
    \iff \anydirmapof{\gamma}{\anydirmap{\alpha} \subd \anydirmap{\beta}} =
    \anydirmap{\delta} \subd \anydirmap{\varepsilon}\] for all such
  $\sharp$ maps and values that fit together. Here we may think of the
  equality as indicating agreement about the definedness
  on each potential value of the form $f \subd g$ (i.e. agreement on
  domain), as well as agreement about where each of these values is
  mapped.

  Alternatively, we may think of this fiberwise, such a map being
  completely determined by what subset of values of the form
  $f \subd g$ lies over each individual direction.
\fi

\begin{prop}
  Polynomial comonoids are categories.
\end{prop}
\begin{proof}
  Let $C$ be a polynomial comonoid. Denote counit by $\varepsilon$
  and comultiplication by $\delta$.
  
  \begin{center}
    \input{fig/counit1.tikz}
    \hspace{-.75em}
    $\underset{\varepsilon}{\transformto}$
    \input{fig/counit2.tikz}
    \quad\qquad
    \input{fig/comult1.tikz}
    \hspace{-.75em}
    $\underset{\delta}{\transformto}$
    \hspace{.5em}
    \input{fig/comult2.tikz}
  \end{center}

  \begin{center}
    \input{fig/idl.tikz}
    \quad
    $\canoniso$
    \input{fig/id.tikz}
    $\canoniso$
    \quad
    \input{fig/idr.tikz}
  \end{center}

  \begin{center}
    \input{fig/assocl.tikz}
    \quad
    $\canoniso$
    \quad
    \input{fig/assocr.tikz}
  \end{center}

  Observe first that the right identity law forces $\posmapof{\delta}{a}_\base = a$
  for all $a \in \pos{C}$.
  Therefore the expression $\posmapof{\delta}{a}_f$ for $f \in \dir{C}{a}$ has a
  well-defined meaning.

  We gather the data for a category $\cat{C}$.
  \begin{itemize}
  \item The set of objects $\Ob(\cat{C})$ is $\pos{C}$, the set
    of positions in $C$.
  \item The set of arrows $\Arr(\cat{C})$ is
    $\sum_{a \in \pos{C}}\dir{C}{a}$, the set of all directions in $C$.
  \item The source map $s$ sends each $f \in \dir{C}{a}$ to $a$. (Hence the
    polynomial $C$ is described by the bundle
    $\Arr(\cat{C}) \bundle{s} \Ob(\cat{C})$.)
  \item The target map $t$ sends each $f \in \dir{C}{a}$ to $\posmapof{\delta}{a}_f$.
  \item The identity map $e$ sends each $a \in \pos{C}$ to
    $\dirmapof{\varepsilon}{a}{\idsubd}$.
  \item The composition map $m$ sends each pair of compatible
    arrows ${f \in \dir{C}{a}}, {g \in \dir{C}{t(f)}}$ to $\dirmapof{\delta}{a}{f \subd g}$.
  \end{itemize}

  Next, observe that if we have such prerequisite data (not laws) for
  a category, subject to just the law $s(e(a)) = a$, then we find that
  further imposing the left identity law $m(e(s(f)), f) = f$
  (and requiring that both sides are defined whenever one is)
  automatically forces the law $t(e(a)) = a$ to hold.\footnote{We have
    $m(e(s(e(a))), e(a)) = e(a)$, since the right side is defined. The
    left side reduces to $m(e(a), e(a))$. This expression only makes
    sense if $t(e(a)) = s(e(a))$, which is $a$.}  Similarly, if we
  have the law $s(m(f,g))=s(f)$ as well as $t(e(a)) = a$, then the
  associativity law $m(m(f,g),h) = m(f,m(g,h))$ forces
  $t(m(f,g)) = t(g)$.\footnote{Given that $f$ and $g$ are composable,
    we have $m(m(f,g),e(t(g))) = m(f,m(g,e(t(g))))$, since the right
    side is defined. The left side only makes sense if
    $t(f,g) = s(e(t(g)))$, which is $t(g)$.}

  We verify the data from above satisfy the laws of a category.
  \begin{itemize}
  \item The law $s(e(a)) = a$ is true by construction; $e(a)$ is a
    direction from the position $a$.
  \item The law $s(m(f, g)) = s(f)$ is true by construction; $m(f, g)$
    is a direction from the position $s(f)$.
  \item The left identity law $m(e(s(f)), f) = f$ is directly
    expressed by the comonoid left identity law, which identifies
    ${\anydirmapof{\delta}{\anydirmapof{\varepsilon}{\idsubd} \subd f}}$
    with $f$ whenever this makes sense.\iffalse\footnote{Meaning,
        there are $u$ and $v$ such that
        ${\dirmapof{\delta}{u}{\dirmapof{\varepsilon}{v}{\idsubd} \subd
            f}}$ specifies a direction from position $a$ $\iff$ $f$
        specifies a direction from position $a$; in this case, the
        former and latter are equal.}\fi
  \item The right identity law $m(f, e(t(f))) = f$ is directly
    expressed by the comonoid right identity law, which identifies
    ${\anydirmapof{\delta}{f \subd \anydirmapof{\varepsilon}{\idsubd}}}$
    with $f$ whenever this makes sense.
  \item The associativity law $m(m(f, g), h) = m(f, m(g, h))$ is
    directly expressed by the comonoid associativity law, which
    identifies
    ${\anydirmapof{\delta}{\anydirmapof{\delta}{f \subd g} \subd h}}$ with
    ${\anydirmapof{\delta}{f \subd \anydirmapof{\delta}{g \subd h}}}$ whenever this makes sense.
  \item The law $t(e(a)) = a$ is forced to hold (due to the comonoid
    left identity law).
  \item The law $t(m(f, g)) = t(g)$ is forced to hold (due to the
    comonoid associativity law).
  \end{itemize}

  Conversely, let $\cat{C}$ be a category. We immediately obtain the
  bundle ${\Arr(\cat{C})\bundle{s}\Ob(\cat{C})}$. Let $C$ denote
  the polynomial described by this bundle (the ``outfacing polynomial''
  of $\cat{C}$). We will exhibit a comonoid struture on $C$.
  \begin{itemize}
  \item The counit $\varepsilon$ singles out the identity in each
    object's set of outfacing maps.
  \item The comultiplication $\delta$ endows each object $a$ with the
    map $\dirmap{\delta}{a}$ sending $f \subd g$ to $m(f, g)$ for all
    arrows of the form $f: a \to b$, $g: b \to c$ (through which the
    map $\posmap{\delta}$ is implicit).
  \end{itemize}

  The above processes of translation between the prerequisite data
  (not laws) for a category subject to just $s(e(a)) = a$ and
  $s(m(f, g)) = g$, and the prerequisite data (not laws) of a
  polynomial comonoid subject to just
  $\posmapof{\delta}{a}_\base = a$, are inverse by
  construction. Moreover, we saw earlier that the identity and
  associativity comonoid laws, in this context, directly translate
  to the identity and associativity category laws.
\end{proof}

\begin{prop}
  A polynomial right comodule amounts to a family of copresheaves.
\end{prop}
\begin{proof}
  Let $D$ be a polynomial comonoid with counit $\varepsilon$ and
  comultiplication $\delta$, and let $M$ be a right comodule on
  $D$. Denote right comodule comultiplication by $\rho$.

  \begin{center}
    \input{fig/mod.tikz}
    \hspace{-.75em}
    $\underset{\rho}{\transformto}$
    \hspace{.5em}
    \input{fig/rmod.tikz}
  \end{center}

  \begin{center}
    \input{fig/modid.tikz}
    $\canoniso$
    \quad
    \input{fig/rmodid.tikz}
  \end{center}

  \begin{center}
    \input{fig/rmodassocl.tikz}
    \quad
    $\canoniso$
    \quad
    \input{fig/rmodassocr.tikz}
  \end{center}

  Observe first that the identity law forces $\posmapof{\rho}{a}_\base = a$
  for all $a \in \pos{M}$.
  Therefore the expression $\posmapof{\rho}{a}_x$ for $x \in \dir{M}{a}$ has a
  well-defined meaning.

  Let $\cat{D}$ be the category corresponding to $D$. We gather the
  data for a family of copresheaves $\{X_a\}_{a \in A}$ on $\cat{D}$.
  \begin{itemize}
  \item The family's indexing set $A$ is $\pos{M}$, the set
    of positions in $M$.
  \item The total set of elements $\sum_{d \in \Ob(\cat{D})}X_a(d)$ in
    $X_a$ is $\dir{M}{a}$, the set of directions from $a$.
  \item The bundle map $t$ assigning each element $x$ in $X_a$ its indexing
    object in $\Ob(\cat{D}) = \pos{D}$ is given by $\posmapof{\rho}{a}_x$.
  \item The multiplication map $m$ sends each element $x \in X_a(d)$ and compatible
    arrow $f \in \dir{D}{d}$ to $\dirmapof{\rho}{a}{x \subd f}$.
  \end{itemize}
  
  Next, observe that if we have such prerequisite data (not laws) for
  a copresheaf on $\cat{D}$, then we find that imposing the copresheaf
  associativity law $m(m(x, f), g) = m(x, m(f, g))$ forces the law
  $t(m(x,f)) = t(f)$ to hold.\footnote{Given that $x$ and $f$ are
    composable, we have $m(m(x,f),e(t(f))) = m(x,m(f,e(t(f))))$, since
    the right side is defined. The left side only makes sense if
    $t(x,f) = s(e(t(f)))$, which is $t(f)$.} (The argument works the same
  for copresheaves as it does for categories.)

  We verify each $X_a$ satisfies the laws of a copresheaf on $\cat{D}$.
  \begin{itemize}
  \item The identity law $m(x, e(t(x))) = x$ is directly expressed by
    the right comodule identity law, which identifies
    ${\anydirmapof{\rho}{x \subd \anydirmapof{\varepsilon}{\idsubd}}}$
    whenever this makes sense.
  \item The associativity law $m(m(x, f), g) = m(x, m(f, g))$ is
    directly expressed by the right comodule associativity law, which
    identifies
    ${\anydirmapof{\rho}{\anydirmapof{\rho}{x \subd f} \subd g}}$ with
    ${\anydirmapof{\rho}{x \subd \anydirmapof{\delta}{f \subd g}}}$ whenever this makes sense.
  \item The law $t(m(x, f)) = t(f)$ is forced to hold (due to the
    right comodule associativity law).
  \end{itemize}

  Conversely, let $\{X_a\}_{a \in A}$ be a family of copresheaves on
  $\cat{D}$. Let $M$ denote the polynomial described by the family of
  total sets of elements
  $\{\sum_{d \in \Ob(\cat{D})}X_a(d)\}_{a \in A}$. We will exhibit a right
  $D$-comodule struture on $M$.
  \begin{itemize}
  \item The right comodule comultiplication $\rho$ endows each position $a \in A$ with
    the map $\dirmap{\rho}{a}$ sending each $x \subd f$ to $m(x, f)$ for
    all $x \in X_a(d), f: d \to d' \in \cat{D}$. This implicitly
    determines $\posmapof{\rho}{a}$ as long as the domain of $\dirmap{\rho}{a}$ is
    nonempty; otherwise let $\posmapof{\rho}{a}$ be the unique position in
    $M \sub D$ with $\posmapof{\rho}{a}_\base = a$.
  \end{itemize}

  The above processes of translation between the prerequisite data
  (not laws) for a family of presheaves on $\cat{D}$, and the
  prerequisite data (not laws) of a right $D$-comodule subject to just
  $\posmapof{\rho}{a}_\base = a$, are inverse by
  construction. Moreover, we saw earlier that the identity and
  associativity right comodule laws, in this context, directly translate
  to the identity and associativity copresheaf laws.
\end{proof}

\begin{prop}
  A polynomial left comodule amounts to a copresheaf and a presheaf on that
  copresheaf's category of elements.
\end{prop}
\begin{proof}
  Let $C$ be a polynomial comonoid with counit $\varepsilon$ and
  comultiplication $\delta$, and let $M$ be a left comodule on
  $C$. Denote left comodule comultiplication by $\lambda$.

  \begin{center}
    \input{fig/mod.tikz}
    \hspace{-.75em}
    $\underset{\lambda}{\transformto}$
    \hspace{.5em}
    \input{fig/lmod.tikz}
  \end{center}

  \begin{center}
    \input{fig/lmodid.tikz}
    \quad
    $\canoniso$
    \input{fig/modid.tikz}
  \end{center}
  
  \begin{center}
    \input{fig/lmodassocl.tikz}
    \quad
    $\canoniso$
    \quad
    \input{fig/lmodassocr.tikz}
  \end{center}

  Let $\cat{C}$ be the category corresponding to $C$. We gather the
  data for a copresheaf $X$ on $\cat{C}$.
  \begin{itemize}
  \item The total set of elements $\sum_{c \in \Ob(\cat{C})}X(c)$ in
    $X$ is $\pos{M}$, the set of positions in $M$.
  \item The bundle map $t$ assigning each element $x$ in $X$ its indexing
    object in $\Ob(\cat{C}) = \pos{C}$ is given by $\posmapof{\lambda}{x}_\base$.
  \item The multiplication map $m$ sends each element $x \in \pos{M}$
    and compatible arrow $f \in \dir{C}{t(x)}$ to
    $\posmapof{\lambda}{x}_f$.
  \end{itemize}

  Now we gather the remaining data of a presheaf $Z$ on
  $\int_{\cat{C}}X$, the category of elements of $X$. (We will have
  accumulated the data sans laws of a copresheaf on $\cat{C}$ and
  presheaf on its category of elements; we are still yet to
  verify $X$ satisfies the laws of a copresheaf on $\cat{C}$.)
  \begin{itemize}
  \item The set $Z(x)$ for $x \in \Ob(\int_{\cat{C}}X) = \pos{M}$ is
    $\dir{M}{x}$, the set of directions from $x$. Hence we obtain the
    bundle map $s$ from the total set of elements
    $\sum_{x \in \Ob(\int_{\cat{C}}X)}Z(x)$ to $\Ob(\int_{\cat{C}}X)$
    sending each $z \in Z(x)$ to $x$.
  \item The multiplication map $m$ sends each arrow $f|_w: w \to x$
    (in $\int_{\cat{C}}X$, lying over $f: t(w) \to t(x)$ in $\cat{C}$)
    and $x$-indexed element $z \in Z(x) = \dir{M}{x}$ to
    $\dirmapof{\lambda}{w}{f \subd z}$.

    (To be clear, the domain of this map is the set of tuples
    $(w, f, z)$ such that $t(w) = s(f)$ and $m(w, f) = s(z)$. This is
    indeed the set of pairs $(f|_w, z)$ that should belong in the
    domain of multiplication for our presheaf on $\int_{\cat{C}}X$,
    since an arrow $f|_w$ in $\int_{\cat{C}}X$ is a pair $(w, f)$ such
    that $t(w) = s(f)$, and the target of this arrow is $m(w, f)$.)
  \end{itemize}

  We will also use the following notation for identities and
  composition in $\int_{\cat{C}}X$.
  \begin{itemize}
  \item If $x$ is an element of $X$, then $e(x)$ will refer to
    $e(t(x))|_x$.
  \item If $f|_w$ and $g|_{m(w,f)}$ are composable arrows in
    $\int_{\cat{C}}X$, then $m(f|_w, g|_{m(w,f)})$ will refer to
    $m(f, g)|_w$.
  \end{itemize}

  We verify $X$ satisfies the laws of a copresheaf on $\cat{C}$.
  \begin{itemize}
  \item The identity law $m(x, e(t(x))) = x$ is the content of the left
    comodule identity law for positions, which says that
    $\posmapof{\lambda}{x}_{\dirmapof{\varepsilon}{\posmapof{\lambda}{x}_\base}{\idsubd}} = x$.
  \item The associativity law $m(m(x, f), g) = m(x, m(f, g))$ is the
    content of the left comodule associativity law for positions,
    which says that
    $\posmapof{\lambda}{\posmapof{\lambda}{x}_f}_g =
    \posmapof{\lambda}{x}_{\dirmapof{\delta}{\posmapof{\lambda}{x}_\base}{f
        \subd g}}$.
  \item The law $t(m(x, f)) = t(f)$ is forced to hold by the
    associativity law, as we have seen previously.
  \end{itemize}
  
  Now we verify $Z$ satisfies the laws of a presheaf on $\int_{\cat{C}}X$.
  \begin{itemize}
  \item The identity law $m(e(s(z)), z) = z$ is the content of the left
    comodule identity law for directions, which identifies
    ${\anydirmapof{\lambda}{\anydirmapof{\varepsilon}{\idsubd} \subd z}}$
    with $z$ whenever this makes sense.
  \item The associativity law
    $m(m(f|_w, g|_{m(w,f)}), z) = m(f|_w, m(g|_{m(w,f)}, z))$ is the
    content of the left comodule associativity law for
    directions, which identifies
    ${\anydirmapof{\lambda}{\anydirmapof{\delta}{f \subd g} \subd z}}$
    with
    ${\anydirmapof{\lambda}{f \subd \anydirmapof{\lambda}{g \subd z}}}$
    whenever this makes sense.
  \item The law $s(m(f|_w, z)) = s(f|_w)$ is forced to hold by the
    associativity law, as we have seen previously (in the dual
    scenario).
  \end{itemize}

  Conversely, let $X$ be a copresheaf on $\cat{C}$ and $Z$ be a
  presheaf on $\int_{\cat{C}}X$. We immediately obtain the bundle
  ${\sum_{x \in \Ob(\int_{\cat{C}}X)}Z(x) \bundle{s}
    \Ob(\int_{\cat{C}}X)}$. Let $M$ denote the polynomial described by
  this bundle. We will exhibit a left $C$-comodule struture on $M$.
  \begin{itemize}
  \item The left comodule comultiplication $\lambda$ is defined on
    positions by $\posmapof{\lambda}{x}_\base = t(x)$ and
    $\posmapof{\lambda}{x}_f = m(x,f)$ for all ${f \in \dir{C}{t(x)}}$.
  \item For each position $x$, the map $\dirmap{\lambda}{x}$ sends each
    $f \subd z$ to $m(f|_x, z)$ for all
    ${f \in \dir{C}{t(x)}}, {z \in Z(m(x,f))}$.
  \end{itemize}

  The above processes of translation between the prerequisite data
  (not laws) for a presheaf on the category of elements of a
  copresheaf on $\cat{C}$, and the prerequisite data (not laws) of a
  left $C$-comodule, are inverse by construction. Moreover, we saw
  earlier that the identity and associativity left comodule
  laws, in this context, directly translate to the identity and
  associativity copresheaf and presheaf laws.
\end{proof}

\begin{prop}
  Polynomial bicomodules are prafunctors between presheaf categories.
\end{prop}
\begin{proof}
  Let $C$ and $D$ be polynomial comonoids and let $M$ a bimodule from
  $C$ to $D$ with left module comultiplication $\lambda$ and right
  module comultiplication $\rho$.
  \begin{center}
    \input{fig/modassocl.tikz}
    \quad
    $\canoniso$
    \quad
    \input{fig/modassocr.tikz}
  \end{center}

  We will show that $M$ amounts to a profunctor\footnote{The notation
    $\cat{A} \prof \cat{B}$ for a profunctor
    $\cat{A}^\op \times \cat{B} \to \Set$ is due to Michael Shulman.}
  $(\int_{\cat{C}} X) \prof \cat{D}$, where $\cat{C}$ is the category
  corresponding to $C$, $X$ is a copresheaf on $\cat{C}$, and
  $\cat{D}$ is the category corresponding to $D$.

  Such a profunctor is the same as a prafunctor
  $\Set^{\cat{D}} \to \Set^{\cat{C}}$. Indeed,
  \begin{center}
    prafunctors $\Set^{\cat{D}} \to \Set^{\cat{C}}$
    
    $\updownarrow$
    
    \vspace{-.2em}\mbox{\phantom{\footnotesize for any $\cat{C}$-copresheaf $X$} right
      adjoint functors $\Set^{\cat{D}} \to \Set^{\cat{C}}/X$
      {\footnotesize for any $\cat{C}$-copresheaf $X$}}
    
    $\updownarrow$
    
    \vspace{-.2em}left adjoint functors $\Set^{\cat{C}}/X \to \Set^{\cat{D}}$
    
    $\updownarrow$
    
    \vspace{-.6em}left adjoint functors $\Set^{\int_{\cat{C}}X} \to \Set^{\cat{D}}$

    $\updownarrow$
    
    functors $(\int_{\cat{C}}X)^\op \to \Set^{\cat{D}}$

    $\updownarrow$

    profunctors $(\int_{\cat{C}} X) \prof \cat{D}$.
  \end{center}

  We have already seen that $M$ as a left $\cat{C}$-comodule amounts to a
  $\cat{C}$-copresheaf $X$ and a presheaf $Z$ on $\int_{\cat{C}}X$,
  and that $M$ as a right $\cat{D}$-comodule amounts to a family of
  $\cat{D}$-copresheaves $\{X_i\}_{i \in I}$.

  The set $\pos{M}$ of positions in $M$ serves as both the set of
  elements in the $\cat{C}$-copresheaf $X$, that is,
  $\Ob(\int_{\cat{C}}X)$, as well as the indexing set $I$ for
  $\{X_i\}_{i \in I}$. For any position $x \in \pos{M}$, the set
  $\dir{M}{x}$ of directions from $x$ serves as both $Z(x)$, the set of
  $x$-indexed elements in the $\int_{\cat{C}}X$-presheaf $Z$, as well
  as the set of elements in the $\cat{D}$-copresheaf $X_x$.

  Moreover, $M$ and its left and right comodule structures are recovered
  from such information. That is, the data of a $\cat{C}$-copresheaf
  $X$, a $\int_{\cat{C}}X$-presheaf $Z$, and a $\cat{D}$-copresheaf
  structure on $Z(x)$ for each element $x$ in $X$ is the same as a
  polynomial $M$ equipped with the structure of a left
  $\cat{C}$-module and right $\cat{D}$-module, assuming no
  compatibility.

  The law $m(m(f|_w, z), g) = m(f|_w, m(z, g))$, encoding naturality
  of the maps $Z(f|_w): Z(x) \to Z(w)$ (with respect to the
  $\cat{D}$-copresheaf structure on $Z(x)$ and $Z(w)$), is directly
  expressed by the bicomodule law, which identifies
  $\anydirmapof{\rho}{\anydirmapof{\lambda}{f \subd z} \subd g}$ with
  $\anydirmapof{\lambda}{f \subd \anydirmapof{\rho}{z \subd g}}$ whenever
  this makes sense.

  Thus, a bicomodule $M$ from $\cat{C}$ to $\cat{D}$ is the same as a
  functor $(\int_{\cat{C}} X)^\op \to \Set^{\cat{D}}$, i.e., a profunctor
  $(\int_{\cat{C}} X) \prof \cat{D}$ (i.e., a prafunctor from
  $\Set^{\cat{D}} \to \Set^{\cat{C}}$).
\end{proof}

\begin{prop}
  Maps between bicomodules are natural transformations between prafunctors.
\end{prop}
\begin{proof}
  Under the correspondence between prafunctors and profunctors, a
  natural transformation between prafunctors
  $F, G: \Set^{\cat{D}} \to \Set^{\cat{C}}$ respectively corresponding
  to profunctors
  $M : (\int_{\cat{C}} X_M) \prof \cat{D}, N : (\int_{\cat{C}} X_N)
  \prof \cat{D}$ (where $X_M$ and $X_N$ are $\cat{C}$-copresheaves) is
  identified with a copresheaf map $\posmap{\alpha}$ from $X_M$ to
  $X_N$ and maps $(\dirmap{\alpha}{x})_d$ from
  $N(\posmapof{\alpha}{x}, d)$ to $M(x, d)$, natural in $x$ and $d$.

  Let $C$ and $D$ be polynomial comonoids. Let $M$ and $N$ be
  bimodules from $C$ to $D$, and let $\alpha$ be a bimodule map from
  $M$ to $N$.

  \begin{center}
    \input{fig/mod.tikz}
    \hspace{-.75em}
    $\underset{\alpha}{\transformto}$
    \hspace{.5em}
    \input{fig/modmap.tikz}
  \end{center}

  \begin{center}
    % \input{fig/modmapr1.tikz}
    $\canoniso$
    \quad
    % \input{fig/modmapr2.tikz}
  \end{center}

  \begin{center}
    % \input{fig/modmapl1.tikz}
    $\canoniso$
    \quad
    % \input{fig/modmapl2.tikz}
  \end{center}


  As usual, $\alpha$ consists of maps
  $\posmap{\alpha}: \pos{C} \to \pos{D}$ and
  $\dirmap{\alpha}{x}: \dir{D}{\posmapof{\alpha}{x}} \to \dir{C}{x}$
  for all positions $x \in \pos{C}$.

  Observe first that the 
\end{proof}

\begin{prop}
  Composition of bicomodules is composition of prafunctors.
\end{prop}
\begin{proof}
  Bicomodules from $D$ to $0$ specialize to copresheaves on $D$ (and maps
  between such bicomodules are copresheaf maps). Hence each bicomodule
  $M$ from $C$ to $D$ induces a functor $F_M$ from $D$-copresheaves to
  $C$-copresheaves by precomposition. Accordingly, we have
  $F_{M \sub_D N} \cong F_N \fatsemi F_M$ (for bicomodules $M$ from
  $C$ to $D$ and $N$ from $D$ to $E$).
  
  We show that the prafunctor corresponding to the bimodule $M$ is
  $F_M$.

  
\end{proof}

\end{document}