\documentclass{amsart}
\input{decls}
\title{Polynomial comonoids and bicomodules}
\begin{document}
\maketitle

\vspace{1.5em}

\iffalse
  A \emph{polynomial}\footnote{The name refers to a correspondence
    between families of sets and sums of powers, illustrated by the
    example
    ${2y^4 + y^2 + y \leftrightarrow
      \{\{\ast,\ast,\ast,\ast\},\{\ast,\ast,\ast,\ast\},\{\ast,\ast\},
      \{\ast\}\}}$.} is an indexed family of sets.

  The indexes of sets are called \emph{positions}, and the members of
  indexed sets are called \emph{directions}.

  We will visualize a polynomial as a collection of corollas.

  % figure

  A corolla is a node with arrows pointing out from it; this denotes a
  position and the directions from it.
\fi

Recall the \emph{substitution product} of polynomials $P$ and $Q$, denoted
$P \sub Q$.

\iffalse
  From polynomials $P$ and $Q$, we can form a new polynomial
  of all the possible two-story trees built by stacking $Q$
  corollas atop a $P$ corolla. This is called the \emph{substitution
    product}, denoted $P \sub Q$.
\fi

\begin{itemize}
\item A position $a$ in $P \sub Q$ consists of a position $a_\base$ in
  $P$ and positions $a_f$ in $Q$ for each direction $f$ from
  $a_\base$.
\item A direction from position $a$ in $P \sub Q$ consists of a
  direction $f$ from $a_\base$ and a direction $g$ from $a_f$.
\end{itemize}
\vspace{.5em}
\begin{center}
  \input{fig/sub1.tikz}
  \qquad
  {\Large$=$}
  \quad
  \input{fig/sub2.tikz}
\end{center}
\vspace{1em}

We denote such a direction from such a position in a substitution
product by $f \subd g$.\footnote{Be aware there may be other
  directions named $f \subd g$ from other positions in
  $P \sub Q$.} Accordingly, $\idsubd$ will denote the unique direction
from the unique position in the unit for substitution $\idsub$
(a.k.a. the polynomial $y$).\footnote{Given directions $f$,
    $g$, and $h$ respectively belonging to polynomials $P$, $Q$, and
    $R$, the directions of the form $(f \subd g)\subd h$ belonging to
    $(P \sub Q) \sub R$ and the directions of the form
    $f \subd (g \subd h)$ belonging to $P \sub (Q \sub R)$ are
    identified under the relevant monoidal coherence
    isomorphism. Hence brackets can be omitted.

  Similarly, for any direction $f$ belonging to a polynomial $P$, we
  have that $\idsubd \subd f$ and $f \subd \idsubd$ (respectively
  belonging to $\idsub \sub P$ and $P \sub \idsub$) are both
  canonically identified with $f$.}

\iffalse
  Suppose we have polynomials $P$ and $Q$ and the following
  structure relating them.
  \begin{itemize}
  \item A function $\alpha_1$ from the positions of $P$ to the
    positions of $Q$.
  \item For each position $a$ in $P$, a function $\alpha^\sharp_a$ from the
    directions of $\alpha(a)$ back to the directions of $a$.
  \end{itemize}
  This is called a \emph{transformation} from $P$ to $Q$ (written
  $\alpha: P \to Q$).

  We think of this as a way of replacing each corolla from $P$ with a
  a corolla from $Q$.

  % diagram

  The \emph{composite} of transformations $\alpha : P \to Q$ and
  $\beta : Q \to R$, denoted $\alpha \fatsemi \beta : P \to R$,
  is defined by
  \[
    \posmap{(\alpha \fatsemi \beta)}{a} = \posmap{\beta}{\posmap{\alpha}{a}}
    \quad \text{ and } \quad
    \dirmap{(\alpha \fatsemi \beta)}{a}{f} =
    \dirmap{\alpha}{a}{\dirmap{\beta}{\posmap{\alpha}{a}}{f}},
  \] i.e., we do the corolla replacements in order.

  % diagram

  This definition of transformation plays well with the substitution
  product.

  % definition of parallel composition of transformations
\fi

Note the following identity for transformations $\alpha$ and $\beta$
between polynomials.
\[\dirmap{(\alpha \sub \beta)}{a}{f \subd g} = \underbrace{\dirmap{\alpha}{(a_\base)}{f}}_{\backref}
  \subd \dirmap{\beta}{(a_{\backref})}{g}.\] Or in brief, ``we have
$(\alpha \sub \beta)^\sharp(f \subd g) = \alpha^\sharp(f)
\subd\beta^\sharp(g)$ whenever this makes sense.''\footnote{Meaning,
  ${\dirmap{(\alpha \sub \beta)}{a}{f \subd g}}$ exists $\iff$ there are
  $u$ and $v$ such that
  ${\dirmap{\alpha}{u}{f} \subd \dirmap{\beta}{v}{g}}$ actually
  describes a direction from $a$; in this case the two sides are
  equal.
  
  (We are assuming the analogue of this property holds for $\alpha$
  and $\beta$ themselves: if any $\dirmap{\alpha}{u}{f}$ describes a
  direction from $a$, then $\dirmap{\alpha}{a}{f}$ is defined with
  that value --- and likewise for $\beta$. This is trivially so if
  across the domains of $\alpha$ and $\beta$ we use different names
  for different directions.)
  
  \iffalse
    Indeed, the directions from $a$ are of the form $f' \subd g'$,
    where $f'$ is a direction from $a_\base$ and $g'$ is a direction
    from $a_{f'}$. Hence if the expression
    $\dirmap{\alpha}{x}{f} \subd dirmap{\beta}{y}{g}$ is to describe a
    direction from $a$, then $x$ should be $a_\base$, and $y$ should
    be $a_{f'}$.
  \fi
}

\iffalse
  Given a transformation $\alpha$, the map $\alpha_0$ is implicitly
  determined by the domains of the $\alpha^\sharp$
  maps. Moreover, a position in a substitution product is determined
  by the set of names of directions from it (at least, assuming
  the positions in the factor polynomials have this property too), even though
  distinct positions may share certain direction names.

  Hence an equation between horizontal ($\sub$) composites of transformations
  amounts to firstly an identification between domains of the composite
  $\sharp$ maps and secondly their agreement in mapping.

  (We can more generally think of any equality between transformations in
  terms of identification of $\sharp$ maps' domains and their
  agreement in mapping. But this is only interesting when we
  have some reason to think of distinct $\sharp$ domains as sharing
  certain direction names.)

  We can translate arbitrary equalities built from $\sub$
  into equalities built from $\subd$, e.g.
  \[\gamma \fatsemi (\alpha \sub \beta) = \delta \sub \varepsilon
    \iff \gamma^\sharp (\alpha^\sharp \subd \beta^\sharp) =
    \delta^\sharp \subd \varepsilon^\sharp\] for all such
  $\sharp$ maps and values that fit together. Here we may think of the
  equality as indicating agreement about the definedness
  on each potential value of the form $f \subd g$ (i.e. agreement on
  domain), as well as agreement about where each of these values is
  mapped.

  Alternatively, we may think of this fiberwise, such a map being
  completely determined by what subset of values of the form
  $f \subd g$ lies over each individual direction.
\fi

\begin{prop}
  Polynomial comonoids are categories.
\end{prop}
\begin{proof}
  Let $C$ be a polynomial comonoid. Denote counit by $\varepsilon$
  and comultiplication by $\delta$.
  
  \begin{center}
    \input{fig/counit1.tikz}
    \hspace{-.75em}
    $\underset{\varepsilon}{\transformto}$
    \input{fig/counit2.tikz}
    \quad\qquad
    \input{fig/comult1.tikz}
    \hspace{-.75em}
    $\underset{\delta}{\transformto}$
    \hspace{.5em}
    \input{fig/comult2.tikz}
  \end{center}

  \begin{center}
    \input{fig/idl.tikz}
    \quad
    $\canoniso$
    \input{fig/id.tikz}
    $\canoniso$
    \quad
    \input{fig/idr.tikz}
  \end{center}

  \begin{center}
    \input{fig/assocl.tikz}
    \quad
    $\canoniso$
    \quad
    \input{fig/assocr.tikz}
  \end{center}

  Observe first that the right identity law forces $(\posmap{\delta}{a})_\base = a$
  for all $a \in \pos{C}$.
  Therefore the expression $(\posmap{\delta}{a})_f$ for $f \in C[a]$ has a
  well-defined meaning.

  We gather the data for a category $\cat{C}$.
  \begin{itemize}
  \item The set of objects $\Ob(\cat{C})$ is $\pos{C}$, i.e., the set
    of positions in $C$.
  \item The set of arrows $\Arr(\cat{C})$ is
    $\sum_{a \in \pos{C}}C[a]$, i.e., the set of all directions in $C$.
  \item The source map $s$ sends each $f \in C[a]$ to $a$. (Hence the
    polynomial $C$ is described by the bundle
    $\Arr(\cat{C}) \bundle{s} \Ob(\cat{C})$.)
  \item The target map $t$ sends each $f \in C[a]$ to $(\posmap{\delta}{a})_f$.
  \item The identity map $e$ sends each $a \in \pos{C}$ to
    $\dirmap{\varepsilon}{a}{\idsubd}$.
  \item The composition map $m$ sends each pair of compatible
    arrows ${f \in C[a]}, {g \in C[t(f)]}$ to $\dirmap{\delta}{a}{f \subd g}$.
  \end{itemize}

  Next, observe that if we have such prerequisite data (not laws) for
  a category, subject to just the law $s(e(a)) = a$, then we find that
  further imposing the left identity law $m(e(s(f)), f) = f$
  (requiring that both sides are defined whenever one is)
  automatically forces the law $t(e(a)) = a$ to hold.\footnote{We have
    $m(e(s(e(a))), e(a)) = e(a)$, since the right side is defined. The
    left side reduces to $m(e(a)), e(a))$. This expression only makes
    sense if $t(e(a)) = s(e(a))$, which is $a$.}  Similarly, if we
  have the law $s(m(f,g))=s(f)$ as well as $t(e(a)) = a$, then the
  associativity law $m(m(f,g),h) = m(f,m(g,h))$ forces
  $t(m(f,g)) = t(g)$.\footnote{Given that $f$ and $g$ are composable,
    we have $m(m(f,g),e(t(g))) = m(f,m(g,e(t(g))))$, since the right
    side is defined. The left side only makes sense if
    $t(f,g) = s(e(t(g)))$, which is $t(g)$.}

  We verify the data from above satisfy the laws of a category.
  \begin{itemize}
  \item The law $s(e(a)) = a$ is true by construction; $e(a)$ is a
    direction from the position $a$.
  \item The law $s(m(f, g)) = s(f)$ is true by construction; $m(f, g)$
    is a direction from the position $s(f)$.
  \item The left identity law $m(e(s(f)), f) = f$ is directly
    expressed by the comonoid left identity law, which identifies
    ${\delta^\sharp(\varepsilon^\sharp(\idsubd) \subd f)}$ with $f$.
  \item The right identity law $m(f, e(t(f))) = f$ is directly
    expressed by the comonoid right identity law, which identifies
    ${\delta^\sharp(f \subd \varepsilon^\sharp(\idsubd))}$ with $f$.
  \item The associativity law $m(m(f, g) h) = m(f, m(g, h))$ is
    directly expressed by the comonoid associativity law, which
    identifies ${\delta^\sharp(\delta^\sharp(f \subd g) \subd h)}$ with
    ${\delta^\sharp(f \subd \delta^\sharp(g \subd h))}$.
  \item The law $t(e(a)) = a$ is forced to hold (due to the comonoid
    left identity law).
  \item The law $t(m(f, g)) = t(g)$ is forced to hold (due to the
    comonoid associativity law).
  \end{itemize}

  Conversely, let $\cat{C}$ be a category. We immediately obtain the
  bundle ${\Arr(\cat{C})\bundle{s}\Ob(\cat{C})}$. Let $C$ denote
  the polynomial described by this bundle (the ``outfacing polynomial''
  of $\cat{C}$); we exhibit a comonoid struture on $C$.
  \begin{itemize}
  \item The counit $\varepsilon$ singles out the identity in each
    object's set of outfacing maps.
  \item The comultiplication $\delta$ endows each object $a$ with
    the map $\delta^\sharp_a$ sending $f \subd g$ to $f \fatsemi g$
    for all arrows of the form $f: a \to b$, $g: b \to c$ (through
    which the map $\delta_0$ is implicit).
  \end{itemize}

  The above processes of translation between the prerequisite data
  (not laws) for a category subject to just $s(e(a)) = a$ and
  $s(m(f, g)) = g$, and the prerequisite data (not laws) of a
  polynomial comonoid subject to just
  $(\posmap{\delta}{a})_\base = a$, are inverse by
  construction. Moreover, we saw earlier that the identity and
  associativity category laws, in this context, directly translate
  to the identity and associativity comonoid laws.
\end{proof}

\begin{prop}
  A polynomial right comodule amounts to a family of copresheaves.
\end{prop}
\begin{proof}
  Let $D$ be a polynomial comonoid and let $M$ be a right comodule on
  $D$. Denote right comodule comultiplication by $\rho$.

  \begin{center}
    \input{fig/rmod1.tikz}
    \hspace{-.75em}
    $\underset{\rho}{\transformto}$
    \hspace{.5em}
    \input{fig/rmod2.tikz}
  \end{center}

  \begin{center}
    \input{fig/modid.tikz}
    $\canoniso$
    \quad
    \input{fig/rmodid.tikz}
  \end{center}

  \begin{center}
    \input{fig/rmodassocl.tikz}
    \quad
    $\canoniso$
    \quad
    \input{fig/rmodassocr.tikz}
  \end{center}

  Let $\cat{D}$ be the category corresponding to $D$. 
  
\end{proof}

\begin{prop}
  A polynomial left comodule amounts to a copresheaf and a presheaf on that
  copresheaf's category of elements.
\end{prop}
\begin{proof}
  Let $C$ be a polynomial comonoid and let $M$ be a left comodule on
  $C$. Denote left comodule comultiplication by $\lambda$.

  \begin{center}
    \input{fig/lmod1.tikz}
    \hspace{-.75em}
    $\underset{\lambda}{\transformto}$
    \hspace{.5em}
    \input{fig/lmod2.tikz}
  \end{center}

  \begin{center}
    \input{fig/lmodid.tikz}
    \quad
    $\canoniso$
    \input{fig/modid.tikz}
  \end{center}
  
  \begin{center}
    \input{fig/lmodassocl.tikz}
    \quad
    $\canoniso$
    \quad
    \input{fig/lmodassocr.tikz}
  \end{center}

  Let $\cat{D}$ be the category corresponding to $D$. 
  
\end{proof}

\begin{prop}
  Polynomial bicomodules are prafunctors between presheaf categories.
\end{prop}
\begin{proof}
  Let $C$ and $D$ be polynomial comonoids and let $M$ be a bimodule
  from $C$ to $D$.  
  \begin{center}
    \input{fig/modassocl.tikz}
    \quad
    $\canoniso$
    \quad
    \input{fig/modassocr.tikz}
  \end{center}

  We will show that $M$ amounts to a profunctor\footnote{The notation
    $\cat{A} \prof \cat{B}$ for a profunctor
    $\cat{A}^\op \times \cat{B} \to \Set$ is due to Michael Shulman.}
  $(\int_{\cat{C}} R) \prof \cat{D}$, where $\cat{C}$ is the category
  corresponding to $C$, $\int_{\cat{C}} R$ is the category of elements
  of the copresheaf $R$ on $\cat{C}$ induced by $M$ as a left
  comodule, and $\cat{D}$ is the category corresponding to $D$.

  Such a profunctor is equivalent to a prafunctor
  $\Set^{\cat{D}} \to \Set^{\cat{C}}$. Indeed,

  \begin{align*}
    &\cong
  \end{align*}
  
\end{proof}

\begin{prop}
  Maps between bicomodules are natural transformations between prafunctors.
\end{prop}
\begin{proof}
  
\end{proof}

\begin{prop}
  Composition of bicomodules is composition of prafunctors.
\end{prop}
\begin{proof}
  Recall bicomodules from $D$ to $0$ are copresheaves on $D$ (and maps
  between such bicomodules are copresheaf maps). Hence each bicomodule
  $M$ from $D$ to $D$ induces a functor $F_M$ from $D$-copresheaves to
  $C$-copresheaves by precomposition. Accordingly, we have
  $F_{M \sub_D N} \cong F_N \fatsemi F_M$ (for bicomodules $M$
  from $C$ to $D$ and $N$ from $D$ to $E$).
  
  We show that the prafunctor corresponding to the bimodule $M$ is $F_M$. 
\end{proof}

\end{document}